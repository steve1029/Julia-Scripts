
<meta charset="utf-8">
<html lang="ko">
<head>
    <link rel="stylesheet" type="text/css" href="./../style.css" />
    <title>16. 서버의 유지 및 관리</title>
</head>
<body id="tt-body-page" class="">
<div id="wrap" class="wrap-right">
    <div id="container">
        <main class="main ">
            <div class="area-main">
                <div class="area-view">
                    <div class="article-header">
                        <div class="inner-article-header">
                            <div class="box-meta">
                                <h2 class="title-article">16. 서버의 유지 및 관리</h2>
                                <div class="box-info">
                                    <p class="category">리눅스/데비안 서버 구축</p>
                                    <p class="date">2016-10-06 11:31:41</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="article-view">
                        <div class="contents_style">
                            <p>1. 메인보드 설정<br><br>2. 노드의 커널 업데이트<br><br>3. 사용자 계정 추가하기<br><br>4. ystat 설치하기<br></p><p><br></p><p>16. ystat 코드 설명.</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>각 노드들에는 ystat-daemon이라는 background 프로그램이 돌아가고 있다.</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>이 데몬은 각 시스템의 상태를 텍스트 파일로 기록한 다음 모든 노드들이 공유하고 있는</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>폴더에 저장한다. 그리고 서버는 이 파일을 모두 취합하여 종합적인 노드들의 프로세스 정보를</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>출력한다. 이것이 ystat 명령어이다.</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>여태까지 노드들이 서버와 공유하는 파일은 있었어도, 모든 노드들끼리도 공유할 수 있었던</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>폴더는 없었다. 그것을 만들어줘야 한다.</p><p><span class="Apple-tab-span" style="white-space:pre">	</span></p><p><span class="Apple-tab-span" style="white-space:pre">	</span># chroot /nfsroot/cpunode</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span># vi /etc/fstab</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>다음 항을 추가한다.</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>192.168.100.1:/root<span class="Apple-tab-span" style="white-space:pre">	</span>/root<span class="Apple-tab-span" style="white-space:pre">	</span>nfs<span class="Apple-tab-span" style="white-space:pre">	</span>defaults,async,nosuid,nodev,intr,nfsvers=3,rsize=32768,wsize=32768<span class="Apple-tab-span" style="white-space:pre">	</span>0<span class="Apple-tab-span" style="white-space:pre">	</span>0</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>이제 서버의 /root 폴더를 모든 노드들의 /root에 마운트 시켰으므로, 모든 노드는 부팅 서버와 같은</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>/root 폴더를 가지게 된다. 노드의 /root에 들어가면 서버의 /root 가 보일 것이다. 여기에 노드들이 각 시스템의 정보를 업로드시킨다.</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>ystat_daemon은 파이썬코드로 쓰여진 백그라운드 프로그램이다. 이를 데몬 프로그램이라 한다. 파이썬으로 실행파일을 만들기 위해서는</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>psutil 이라는 파이썬 모듈이 필요하다. 그리고 그렇게 쓰여진 파이썬 코드가 명령어가 되기 위해서는 (ls, cd, mkdir 과 같은 명령어)</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>리눅스에 설치된 프로그램들을 실행시킬 수 있는 실행권한을 가져한다.</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>그 권한을 주는 명령어가 chmod(change mode) 이다. 먼저 간단한 test 파일을 만들어보자.</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span># vi /home/ldg/test</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>다음과 같이 입력한다.</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>print "hello"</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>저장하고 실행시켜보자.</p><p><span class="Apple-tab-span" style="white-space:pre">	</span></p><p><span class="Apple-tab-span" style="white-space:pre">	</span># python test</p><p><span class="Apple-tab-span" style="white-space:pre">	</span>hello</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>라고 뜰 것이다.</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span># ls -alph test</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>-rw-r--r-- 어쩌구저쩌구</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>ls -alph는 상세 정보를 보여준다. 여기서 맨 첫째 칸은 d 나 - 이다.</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">		</span>d : 디렉토리</p><p><span class="Apple-tab-span" style="white-space:pre">		</span>- : 파일</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>그다음은 rwxrwxrwx 순이다. 이는 read write execute 의 약자로서 소유자/그룹사용자/전체사용자 순으로 읽기,쓰기,실행 권한을 표기한 것이다.</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>소유자 권한에 rw- 라 되어 있는 것을 보아 소유자(파일을 만든 사람)은 읽고 쓰기만 될 뿐, 이 파일로 다른 프로그램을 실행시킬 수 없다.</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>2진수로 표현했을때, rwx 권한을 주려면 111 이다. 이것은 10진수로 7이다. 내가 소속한 그룹 사용자들, 다른 전체 사용자들에게 r-x 권한을</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>주고 싶으면 101 이라고 해주면 되고 이것은 5 이다. 따라서 chmod 명령어를 다음과 같이 내린다.</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>chmod 755 ./test</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>vi ls -alph test</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>-rwxr-xr-x 라고 바뀐 것을 볼 수 있을 것이다.</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>이제 실행 권한이 있으니 굳이</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span># python test 라 하지 않고 # test 라고만 해도 파일이 실행될 수 있다.</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span># test</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>하지만 아무 것도 실행되지 않을 것이다. 왜냐면, 이제 이 test는 자기가 python 인지 모른다. 그래서 한 줄을 더 추가해줘야한다.</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span># vi test</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>맨 윗 줄에</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>#!/usr/bin/env python</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>이것은 shell script로, 이 파일이 python 언어로 만들어져 있음을 알려주는 줄이다.</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>저장하고 나와서 다시 # test 를 해보자</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>오류는 안나는데 아무런 결과가 뜨지 않는다. 왜일까?</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>이미 test라는 명령어가 존재하기 때문이다.&nbsp;</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span># whereis test</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>test: /usr/bin/test /usr/share/man/man1/test.1.gz</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>이미 명령어가 bin에 존재한다. 실행파일위치, 소스위치, man 페이지 파일의 위치 순이다(test의 실행파일위치는 없다). 그래서 그냥 test를 실행하면 안되고</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>내가 실행하고 싶은 test 파일이 어디에 있는지 꼭 명시 해주어야 한다.</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span># ./test</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>hello world</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>이제 성공적으로 실행파일을 만드는데 성공했다.</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>그럼 이제 각 노드에서 실행될 ystat_daemon을 만들 준비가 된 것이다.</p><p><span class="Apple-tab-span" style="white-space:pre">	</span></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>ystat_daemon은 모든 노드에서 실행되고 있어야 한다. ystat_daemon은 각 시스템에서 프로세스 현황 정보를 모아 자신의 /root에</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>저장한다. 그런데 노드들의 /root는 서버의 /root에 마운트 되어 있으므로, 서버의 /root에 자신들의 정보를 저장하는 셈이 된다.</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>그럼 ystat_daemon을 노드를 부팅시킬 때 자동으로 실행되도록 해야 편할 것이다. 시작프로그램으로 어떻게 등록시킬까?</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>리눅스는 /etc/init.d 폴더 안에 데몬프로그램 스크립트를 둔다. 데몬 프로그램들은 모두 쉘 스크립트로 짜여진 스크립트 파일이다.</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>/etc/init.d 안의 파일들은 모두 일정한 형식을 따라 쉘 스크립트로만 짜여져 있어야 한다.</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>ystat_daemon은 파이썬코드이므로 /etc/init.d 안에 두지 않고 부트 스크립트로 실행하는 것이 더 편하다. 왜냐하면 쉘 스크립트를 일단 모르는 데다가</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>runlevel 이라는 것을 설정해줘야 해서 귀찮다. 물론 파이썬 스크립트 맨위에 파이썬이라는 걸 알려주는 실행문(그거 왜 있잖아)</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>을 붙여두면 되기야 하지만 runlevel이 귀찮은 거다. 그럼 어떤 방법을 사용할 수 있을까?</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>리눅스는 부팅되기전 /etc/rc.local 이라는 스크립트를 실행한다. 이 스크립트를 보면 무엇을 실행할지 적어놨다.</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>문법 그대로 따라서 ystat_daemon의 경로를 저장해두면 알아서 실행되겠지?</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>각 서버 및 노드에는 ystat_deamon 이 /usr/local/sbin/ 에 저장되어 있다.</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>이 폴더는 명수형이 따로 만든 파일. /usr/local 은 리눅스에는 기본적으로 없는 폴더이다. 사용자가 시스템에 새로운 폴더를</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>추가해서 사용하려면 보통 /usr 폴더안에 만든다. 그래야 루트파일시스템을 건드릴 가능성을 줄일 수 있기 때문이지.</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>이 /usr 안에는 사용자들이 새로만든 명령어들이나 라이브러리 같은것이 저장되어 있다. 명수형은 거기에 local 폴더를 하나 더 만들어서</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>안정성을 취한 것이다. 리눅스의 bin 이나 sbin 폴더는 여러군데에 있다. 리눅스는 이 폴더를 전부 환경변수로 등록해둔다.</p><p><span class="Apple-tab-span" style="white-space:pre">	</span></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>즉 이 안의 파일들은 모두 파일명 그대로 명령어로 쓸 수 있다.</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>/usr/local/bin 폴더에는 yrun, ystat, ytest, dstat 등이 들어가 있다. 이 파일명들은 그대로 사용자들이 명령어처럼 쓸 수 있다.</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>/usr/local/sbin 폴더는 root 권한자만 사용할 수 있는 명령어가 들어가 있다.</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>bin과 sbin 폴더에 대해 정리하자면</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>첫 번째, /bin, /sbin 에는 리눅스 커널에서 기본 제공하는 명령어 셋이 들어 있다.</p><p><span class="Apple-tab-span" style="white-space:pre">	</span></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>두 번째, /usr/bin, /usr/sbin 에는 사용자가 설치하거나 리눅스에서 설치한 애플리케이션들이 제공하는 명령어 셋이 들어 있다.</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>세 번째, /usr/local/bin, /usr/local/sbin 는 위 경우 외에 사용자가 임의로 만든 명령어 셋을 자유롭게 넣고 지울 수 있도록 만든 바이너리폴더.</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span># whereis ystat_daemon</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>ystat_daemon : /usr/local/sbin/ystat_daemon</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>또, 부팅시 자동시작되도록 만들기 위해서 /etc/rc.local 파일을 수정한다.</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span># vi /etc/rc.local</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>여기에 다음 내용을 추가한다.</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>. /lib/lsb/init-functions</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>log_begin_msg "ystat Monitoring DAEMON process starting.."</p><p><span class="Apple-tab-span" style="white-space:pre">	</span>/usr/local/sbin/ystat_daemon</p><p><span class="Apple-tab-span" style="white-space:pre">	</span>log_end_msg $?<span class="Apple-tab-span" style="white-space:pre">	</span></p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>여기서 맨 윗줄은 한번만 쓰면 된다.</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>그리고 서버와 노드의 모든 /etc/rc.local 파일에 새로운 rc.local 파일을 덮어씌우면 된다.</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>그리고 ystat,yrun,ytest,dstat, ystat_daemon 을 chmod 755 해주면 됨.</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>다시 프로세스를 정리해보자면</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>첫 번째, 모든 서버와 노드가 부팅될 시 /etc/rc.local 에 의해 ystat_daemon이 background 에서 자동으로 사용될 것.</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>두 번째, ystat_daemon process 는 끝나지 않는 프로세스이므로, 모든 서버와 노드는 서버의 /root/.ystat/ 에 자신의 정보를 저장한다.</p><p><br></p><p><span class="Apple-tab-span" style="white-space:pre">	</span>세 번째, ystat 명령어는 /root/.ystat/y101 등의 파일을 모두 읽어서 출력시켜준다.</p>
                        </div>
                        <br/>
                        <div class="tags">
                            
                        </div>
                    </div>
                    
                </div>
            </div>
        </main>
    </div>
</div>
</body>
</html>
