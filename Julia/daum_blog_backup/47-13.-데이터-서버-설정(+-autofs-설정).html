
<meta charset="utf-8">
<html lang="ko">
<head>
    <link rel="stylesheet" type="text/css" href="./../style.css" />
    <title>13. 데이터 서버 설정(+ autofs 설정)</title>
</head>
<body id="tt-body-page" class="">
<div id="wrap" class="wrap-right">
    <div id="container">
        <main class="main ">
            <div class="area-main">
                <div class="area-view">
                    <div class="article-header">
                        <div class="inner-article-header">
                            <div class="box-meta">
                                <h2 class="title-article">13. 데이터 서버 설정(+ autofs 설정)</h2>
                                <div class="box-info">
                                    <p class="category">리눅스/데비안 서버 구축</p>
                                    <p class="date">2016-09-27 00:02:15</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="article-view">
                        <div class="contents_style">
                            <p><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">지금까지의 과정에서 dhcp 서버, tftp 서버, nfsroot 서버의 설정을 마쳤다. 이제 마지막으로 데이터 서버의 설정만 하면 전반적인 클러스터의 설정은 다 끝난다. 그 다음으로는 앱 설치과정이 남아 있는데, 이건 서버의 구축 과정이라 할 수 없으므로 다른 카테고리에서 설명하겠다.</span><br></p><p><br></p><p><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">나노광학연구실에서 사용하는 서버는 총 4대이며 그 구성은 다음과 같다.</span></p><p><br></p><p style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">yboot : DHCP서버 + TFTP부트서버 +&nbsp;NFS 루트 서버</span></p><p style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">yhome1 : 데이터 서버 1 + NFS 서버</span><br></p><p style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">yhome2 : 데이터 서버 2 + NFS 서버</span><br></p><p style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">yhome3 : 데이터 서버 3 + NFS 서버</span></p><p style="margin-left: 2em;"><span style="font-size: 9pt;"><br></span></p><p><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">지금까지의 내용은 yboot 에 사용될 설정을 마친 것이다. 여태까지 한 것을 정리하자면, DHCP 서버에서 각 노드들에게 내부 ip를 부여하도록 설정하였으며, TFTP로 부트 이미지 파일을 램디스크형식으로 노드에게 전달하고,&nbsp;NFS 로 노드에게 루트 파일 시스템을 항상 제공하도록 설정하여 노드가 네트워크 부팅이 되도록 만든 것이다.</span></p><p><br></p><p><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">이제 각 노드는 일을 할 준비가 다 되었다. 하지만 아직 설정하지 않은 것이 있다. 대체 무슨 일을 해야하는가?</span></p><p><br></p><p><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">각 사용자들의 데이터를 분석하고 계산하는 용도로 노드가 사용되어야 하는데, 문제는 데이터가 노드에 없다는 것이다. 노드는 하드디스크가 없으므로 데이터는 다른 컴퓨터에 저장해두고, 네트워크로 불러오도록 해야할 것이다. 하지만&nbsp;불러와야할 데이터의 용량이&nbsp;너무 크다면, 부트서버에서 제공해야하는 용량이 너무 크므로 네트워크에 부하가 많이 걸린다. 부팅 서버가&nbsp;데이터 서버의 역할까지 하는 건 무리이다. 따라서, 데이터 서버를 부트서버와 분리하는 것이 바람직하다.</span></p><p><br></p><p><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">나노광학연구실에서는 데이터 서버를 총 3개 운영하고 있다. 데이터 서버는 노드들에게 데이터를&nbsp;</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">'제공'해야하므로 NFS 서버의 역할도 해야한다. 주의할 점은 NFS 부트 서버와는 다르게 제공해야하는 파일의 용량이 크다는 점이다.&nbsp;</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">만약 사용하지 않는 데이터까지 계속 노드에게 전송한다면 네트워크 부하가 너무 커서 불안정한 서버가 된다.&nbsp;</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">이때 사용하는 방법이 autofs 이다. NFS 는 파일시스템을 네트워크로 실시간 제공하지만, 이를 그 fstab으로 마운트시키면 실시간으로 계속 전송된다. 하지만&nbsp;autofs 를 통해 마운트하면 사용자가 요청할때만 데이터를 전송받을 수 있다. 따라서 네트워크 부하가 현저히 줄어든다.</span></p><p><br></p><p><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">이제 yhome1 을 데이터 서버 + NFS 서버로 만들어보자.</span></p><p><br></p><p><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">데이터는 리눅스가 설치된 파티션 외에 다른 파티션에 설치하는 것이 훨씬 안정적이다. 따라서 데이터서버에는&nbsp;여러 하드디스크가 설치될 것이다. 먼저 하드디스크를 설치하고, 컴퓨터 내에서 각각을 구별하는 법을 알아보자.</span></p><p><br></p><p><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">서버의 전원을 내린다음 하드디스크에 전원 케이블을 꽂고 SATA 케이블을 이용해 메인보드와 연결한 뒤 리눅스를 부팅시킨다. 리눅스는 윈도우와 달리 루트 파일시스템이 먼저 있고, 거기에 하드디스크가 폴더 형식으로 추가된다. 설치된 보조기억 장치들은 /dev/{sda, sdb, sdc, ...} 의 형태로 확인할 수 있다.&nbsp;</span></p><p><br></p><p><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">참고) 리눅스가 인식한 순서대로 a, b, c 순의 이름이 붙는다. sd 는 secure digital 의 약자이다. 많이 쓰는 SD 카드할 때 그 sd 이다. SD 카드는 비휘발성(플래쉬) 메모리 카드 포맷 으로, 전원이 끊어져도 안의 데이터가 사라지지 않는다는 장점이 있다. 대신 메모리보다 속도가 느리다.</span></p><p><br></p><p><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">리눅스가 부팅 되면 인식이 되었는지 확인해보자.</span></p><p><br></p><p style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;"># ls -alph /dev/sd*</span></p><p style="margin-left: 2em;"><br></p><p><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">/dev/ 폴더 내에서 sd로 시작하는 모든 파일에 대해 자세히 나열하라는 명령이다.</span></p><p><br></p><p><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">잘 인식된 것을 확인하였다면, 인식된 하드의 파티션을 나누고 적절한 파일시스템으로 포맷한 뒤 마운트해야 한다. 하지만 그 전에, 리눅스가 설치된 하드디스크가 무엇인지 반드시 알아야한다. 함부로 포맷했다간 여태까지 한 작업을 다 날리는 수가 있으니 항상 조심하자.</span></p><p><br></p><p style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;"># df -h</span></p><p style="margin-left: 2em;"><br></p><p><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">각 파티션의 용량과 마운트 포인트가 나타난다. / 에 마운트된 것이 리눅스가 설치된 하드라는 뜻이겠지. 예를 들어 sda 가 / 에 마운트되어 있다면, sdb 부터 파티션을 나누는 작업을 하면 되는 것이다.&nbsp;cfdisk 나 gdisk, parted 앱을 이용하여 파티션을 나누자. 2TB 이상의 하드는 cfdisk 앱을 쓸 수 없다.</span></p><p><br></p><p style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;"># parted</span></p><p style="margin-left: 2em;"><span style="font-size: 9pt;"><br></span></p><p style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">(parted) print</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">(parted) mklabel</span></p><p style="margin-left: 2em;"><br></p><p><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">등등의 작업을 해서 파티션을 나눈다. 자세한 과정은 명령어 카테고리의 parted 글을 참조하자. 파티션을 기호에 따라 나누었으면 쉘로 돌아온다.</span></p><p><br></p><p style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;"># mkfs -t ext4 /dev/sdb1</span></p><p style="margin-left: 2em;"><br></p><p><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">gpt 디스크는 BIOS 메인보드에서는 잘 안읽히는 경우가 있으므로 다시 한번 파일시스템을 만들어주자. -t 는 타입을 설정하겠다는 옵션이다. /dev/sdb1 은 sdb 하드의 첫번째 파티션을 말한다.</span><br></p><p><span style="font-size: 9pt;"><br></span></p><p><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">파티션을 나누었으면 마운트를 시켜야 한다. 이 때, 하드디스크는 서버가 부팅될 때 자동으로 마운트되어야 하므로 fstab 에 기록해야 한다.&nbsp;</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">보통 유저들의 파일은 /home/*</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">username* 에 들어 있다. 하지만, 이미 데이터 서버에는 루트파일시스템이 설치되어 버렸으므로 함부로 /home에 새 하드를 마운트 시켰다가는 리눅스가 아작난다. 따라서 새로운 폴더를 하나만들고, 거기에 새 하드를 마운트시키는 것이 안전한 방법이다. yggdrasil 에서는 /homelocal 이나 /local_home&nbsp;이라는 폴더를 만들고, 새 하드디스크가 추가될 때마다 여기에 마운트 시키기로 한다.</span></p><p><span style="font-size: 9pt;"><br></span></p><p><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">데이터 서버에서 다음을 실행하자. 나는 yhome3 에서 실행하였다.</span></p><p><span style="font-size: 9pt;"><br></span></p><p style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;"># vi /etc/fstab</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">/dev/sda1 &nbsp; /local_home/home1 &nbsp; ext4 &nbsp; &nbsp;defaults &nbsp; &nbsp;0 &nbsp; 0</span></p><p style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">/dev/sdb1 &nbsp; /local_home/home2 &nbsp; ext4 &nbsp; &nbsp;defaults &nbsp; &nbsp;0 &nbsp; 0</span></p><p style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">192.168.100.1:/root /root &nbsp; nfs defaults,async,nosuid,nodev,intr,nfsvers=3,rsize=32768,wsize=32768 &nbsp;0 &nbsp; 0</span></p><div><br></div><p><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">마운트포인트는 자기 맘이다. 16년 10월 04일, yhome3 의 fstab 에는 위 내용이 기록되어 있었다.</span></p><p><br></p><p><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">같은 날 yhome1 의 /etc/fstab 내용</span></p><p><br></p><p style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">/dev/sda1</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">/local_home/home1</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">ext4</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">defaults</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">0</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">0</span></p><p style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">/dev/sdb1</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">/local_home/home2</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">ext4</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">defaults</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">0</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">0</span></p><p style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">192.168.100.1:/root</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">/root</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">nfs</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">defaults,async,nosuid,nodev,intr,nfsvers=3,rsize=32768,wsize=32768</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">0</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">0</span><br></p><p style="margin-left: 2em;"><span style="font-size: 9pt;"><br></span></p><div><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">yhome2의 내용</span></div><div><br></div><div style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">/dev/sda1</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">/local_home/home1</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">ext4</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">defaults</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">0</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">0</span></div><div style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">/dev/sdb1</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">/local_home/home2</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">ext4</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">defaults</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">0</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">0</span></div><div style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">192.168.100.1:/root</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">/root</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">nfs</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">defaults,async,nosuid,nodev,intr,nfsvers=3,rsize=32768,wsize=32768</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">0</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">0</span></div><div><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">yboot의 fstab 내용</span></div><div><span style="font-size: 9pt;"><p><A href="https://t1.daumcdn.net/cfile/blog/2525835057F3863E24?download" target="_blank"><img src="//i1.daumcdn.net/icon/editor/p_etc_s.gif"/> fstab</a></p><p><br></p></span></div><div><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">여기서 알 수 있는 것 중 첫 번째는 모든 데이터 서버는 yboot(192.168.100.1)의 /root 를 자신의 /root 에 마운트 하고 있다. 이는 차후 적용할 ystat 코드 때문이다. 이는 곧 yboot가 /root 를 NFS로 제공하고 있다는 증거도 된다.&nbsp;두 번째는 모두 각자의 하드 1,2번을 /local_home/home1 과 home2 에 마운트 하고 있다. 확인해본 결과 OS 는 sdc 에 설치되어 있으니 sda 와 sdb 는 오로지 데이터 저장만을 위한 하드이다.</span></div><div><br></div><div><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">이제 이렇게 하드를 마운트 했으니, 모든 노드에게 접근 권한을 주어야 한다. 이는 NFS 서버로서 동작해야한다는 뜻이다.&nbsp;</span></div><div style="margin-left: 2em;"><br></div><div style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;"># aptitude install -y nfs-kernel-server</span></div><div><br></div><div><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">이제 /etc/exports 의 내용을 보자. 이 파일은 NFS 로 제공할 파일과 그 옵션을 기록해 놓은 파일이다. 모든 yhome1, yhome2, yhome3 에는 다음의 내용이 기록되어 있었다.</span></div><div style="margin-left: 2em;"><span style="font-size: 9pt;"><br></span></div><div style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">/local_home/home1</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">192.168.100.0/24(rw,no_root_squash,no_subtree_check,sync)</span></div><div><div style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">/local_home/home2</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">192.168.100.0/24(rw,no_root_squash,no_subtree_check,sync)</span></div></div><div><br></div><div><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">이는 자신의 /local_home/home1, home2 를 ip 주소가&nbsp;192.168.100. 로 시작하는 모든 host 에게 제공하겠다는 뜻이다. /24는 subnetmask가 255.255.255.0 라는 뜻이다. 즉&nbsp;192.168.100.0 ~ 192.168.100.255 라는 뜻과 같다. 그리고&nbsp;옵션을 보면 rw, 즉 읽기 쓰기 권한을 다 주고 있으며&nbsp;</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">노드에서 root 접속을 허용(</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">no_root_squash)하고 있음을 알 수 있다. 참고로 yboot의 /etc/exports 는 다음과 같다.</span></div><div><span style="font-size: 9pt;"><p><A href="https://t1.daumcdn.net/cfile/blog/215A814957F386C331?download" target="_blank"><img src="//i1.daumcdn.net/icon/editor/p_etc_s.gif"/> exports</a></p><p><br></p></span></div><p><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">이로서 모든 데이터서버는 새 하드를&nbsp;</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">/local_home/home 1,2 에 마운트 시킨 뒤&nbsp;</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">자신의 /local_home/home 1,2 를 노드에 제공하고 있다는 것을 알 수 있다.</span></p><p><span style="font-size: 9pt;"><br></span></p><p><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">이제 노드에서는 이를 받기만 하면 된다. 하지만 아까도 말했듯, 필요할 때만 받아야 한다. 이는 autofs 라는 앱이 필요하다. 노드의 루트파일시스템에 autofs 라는 앱을 설치하자.</span></p><p><span style="font-size: 9pt;"><br></span></p><p style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;"># chroot y101</span></p><p style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;"># aptitude install -y autofs</span></p><p style="margin-left: 2em;"><br></p><p><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">autofs 의 설정 파일은 /etc/auto.master 이다. 여기에 직접 내용을 써도 되지만, 일반적인 방법은 auto.master 파일에 다른 설정 파일을 등록해 두고, 그 설정파일을 편집하는 방법이다. 이 경우 autofs 설정 파일을 여러개로 분산시켜 관리할 수 있기 때문에 편리하다. 새로운 설정 파일의 이름을 auto.home 이라고 한다면 auto.master 파일을 다음과 같이 수정하면 된다. 명심하자. 여긴 지금 노드 y101의 루트 파일 시스템이다.</span></p><p><br></p><p style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;"># vi /etc/auto.master</span><br></p><p><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">여기에 다음의 내용을 추가한다.</span></p><p style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">/home /etc/auto.home</span></p><p style="margin-left: 2em;"><br></p><p><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">이는 /home 에 auto.home 이라는 설정파일을 적용하겠다는 내용이다. 예상할 수 있는 것은, 노드의 /home 에서 /etc/auto.home 에 기록된 폴더를 앞으로 찾을 수 있게 된다는 사실이다. 그 폴더가 /home 에 없더라도, 내가 찾을 때 autofs 가 자동으로 NFS로 제공되고 있는 폴더 중에서 찾아서 연결 시켜 줄 것이다. 진짜로 그런지 보자.</span></p><p><br></p><p style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;"># vi /etc/auto.home</span></p><p style="margin-left: 2em;"><br></p><p><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">다음의 내용을 등록한다. 이는 모든 노드와 서버에 적용하면 된다.</span></p><p><br></p><p style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">lsy</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">192.168.100.51:/local_home/home1/lsy</span></p><p style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">kifang</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">192.168.100.51:/local_home/home2/kifang</span></p><p style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">cptb</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">192.168.100.51:/local_home/home2/cptb</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">qpark</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">192.168.100.52:/local_home/home1/qpark</span></p><p style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">intro15</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">192.168.100.52:/local_home/home1/intro15</span></p><p style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">ldg</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">192.168.100.52:/local_home/home1/ldg</span></p><p style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">cris123</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">192.168.100.52:/local_home/home2/cris123</span></p><p style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">dahlia</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">192.168.100.52:/local_home/home2/dahlia</span></p><p style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">immalku</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">192.168.100.52:/local_home/home2/immalku</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">kbs &nbsp; &nbsp; 192.168.100.53:/local_home/home1/kbs</span></p><p style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">smsmsms</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">192.168.100.53:/local_home/home1/smsmsms</span></p><p style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">turtle</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">192.168.100.53:/local_home/home1/turtle</span></p><p style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">encube</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">192.168.100.53:/local_home/home2/encube</span></p><p style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">triumph</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">192.168.100.53:/local_home/home2/triumph</span></p><p style="margin-left: 2em;"><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">kth</span><span class="Apple-tab-span" style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt; white-space: pre;">	</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">192.168.100.53:/local_home/home2/kth</span></p><div><br></div><div><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">쉘 스크립트에서는&nbsp;각 항목은 tab이나 space로 구별한다. 에디터의 한계로 space 와 tab 이 섞여보이는데, 폴더 이름과 실제 폴더의 위치는 tab 을 이용해서 구별해주어야 쉘이 이 스크립트를 인식할 것이다.</span></div><div><br></div><div><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">위 스크립트 내용을 해석해보자. 각 노드의 /home 에 들어가서 ls 명령을 내리면, 처음에는 아무것도 안 뜰 것이다. 그런데 거기서 cd ldg 라고 해보자. 들어가진다! 그게 바로 autofs 가 작용한 것이다. 내가 처음에 ls 명령을 내릴 땐 아무것도 찾은 적이 없으니 마운트가 안된다. 하지만 cd ldg 라고 치는 순간 ldg 폴더를 내가 찾은 것이 되고, autofs 는&nbsp;</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">192.168.100.52:/local_home/home1/ldg 를 바로 마운트 시켜 연결해준 것이다. 이제 y101 의 노드 설정이 다 끝났으니, 모든 노드에도 동일한 설정을 적용하면 된다.</span></div><p><br></p><p style="margin-left: 2em;"><span style='line-height: 107%; font-family: "Times New Roman",serif; font-size: 10pt; mso-fareast-font-family: 바탕; mso-ansi-language: EN-US; mso-fareast-language: KO; mso-bidi-language: AR-SA;'><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">#
rsync -aHv --delete /nfsroot/y101</span><span style="color: rgb(204, 204, 204); font-family: Dotum; font-size: 9pt;">/ /nfsroot/y102</span></span><br></p><p style="margin-left: 2em;"><span style='line-height: 107%; font-family: "Times New Roman",serif; font-size: 10pt; mso-fareast-font-family: 바탕; mso-ansi-language: EN-US; mso-fareast-language: KO; mso-bidi-language: AR-SA;'><span style="font-family: Dotum; font-size: 11pt;"><br></span></span></p><p><span style="color: rgb(204, 204, 204); font-size: 9pt;">위 명령어를 다시 설명하자면,&nbsp;</span><span style="color: rgb(204, 204, 204); font-size: 9pt;">/nfsroot/y101</span><span style="color: rgb(204, 204, 204); font-size: 9pt;">/ 에서&nbsp;</span><span style="color: rgb(204, 204, 204); font-size: 9pt;">/nfsroot/y102 로의 단방향 동기화이며, --delete 라는 옵션은 y102에는 있지만 y101에는 없는 파일이 있다면, y102에서 그 파일들을 지우라는 의미이다. 즉 y101과 y102의 폴더 내용은 완전히 같아진다.</span></p><figure class="fileblock" data-ke-align="alignCenter">
    <a href="./file/exports" class="">
        <div class="image"></div>
        <div class="desc">
            <div class="filename">
                <span class="name">exports</span>
            </div>
            <div class="size">0.01MB</div>
        </div>
    </a>
</figure><figure class="fileblock" data-ke-align="alignCenter">
    <a href="./file/fstab" class="">
        <div class="image"></div>
        <div class="desc">
            <div class="filename">
                <span class="name">fstab</span>
            </div>
            <div class="size">0.01MB</div>
        </div>
    </a>
</figure>
                        </div>
                        <br/>
                        <div class="tags">
                            
                        </div>
                    </div>
                    
                </div>
            </div>
        </main>
    </div>
</div>
</body>
</html>
