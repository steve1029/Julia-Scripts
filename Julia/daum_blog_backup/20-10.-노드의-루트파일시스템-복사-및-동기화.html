
<meta charset="utf-8">
<html lang="ko">
<head>
    <link rel="stylesheet" type="text/css" href="./../style.css" />
    <title>10. 노드의 루트파일시스템 복사 및 동기화</title>
</head>
<body id="tt-body-page" class="">
<div id="wrap" class="wrap-right">
    <div id="container">
        <main class="main ">
            <div class="area-main">
                <div class="area-view">
                    <div class="article-header">
                        <div class="inner-article-header">
                            <div class="box-meta">
                                <h2 class="title-article">10. 노드의 루트파일시스템 복사 및 동기화</h2>
                                <div class="box-info">
                                    <p class="category">리눅스/데비안 서버 구축</p>
                                    <p class="date">2016-09-25 23:58:47</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="article-view">
                        <div class="contents_style">
                            <p><span style="font-family: Dotum; font-size: 10pt;">앞에서 노드 y101에 대한 루트 파일시스템을 /nfsroot/y101 에 만들었다.</span></p><p><span style="font-family: Dotum; font-size: 10pt;"><br></span></p><p><span style="font-family: Dotum; font-size: 10pt;">이 방법은 루트 파일 시스템을 인터넷을 통해 다운 받아서 설치한 방식이다.</span></p><p><span style="font-family: Dotum; font-size: 10pt;"><br></span></p><p><span style="font-family: Dotum; font-size: 10pt;">하지만, 노드는 하나가 아니라 70대다.</span></p><p><span style="font-family: Dotum; font-size: 10pt;"><br></span></p><p><span style="font-family: Dotum; font-size: 10pt;">이걸 70번이나 반복해줘야 한다면, 매우 오래 걸리고 비효율적인 방식이다.</span></p><p><span style="font-family: Dotum; font-size: 10pt;"><br></span></p><p><span style="font-family: Dotum; font-size: 10pt;">이 때 사용할 수 있는 패키지가 있다.</span><br><br><span style="font-family: Dotum; font-size: 10pt;">cp 명령어 보다 좀 더 완벽한 복사를 할 수 있는 rsync 패키지를 이용해야 한다.</span></p><p><span style="font-family: Dotum; font-size: 10pt;"><br></span></p><p><span style="font-family: Dotum; font-size: 10pt;">yboot 에서 다음의 명령을 실행하자.</span></p><p style="margin-left: 6em;"><br></p><p style="margin-left: 2em;"><span style="font-family: Dotum; font-size: 10pt;"># aptitude install -y rsync</span></p><p><br></p><p><span style="font-family: Dotum; font-size: 10pt;">먼저 /nfsroot/xenial-&lt;kernel version&gt; 에 debootstrap 을 이용한 루트파일시스템의 원형을 만들 것이다.</span></p><p><span style="font-family: Dotum; font-size: 10pt;"><br></span></p><p><span style="font-family: Dotum; font-size: 10pt;">현재 yboot 의 커널 버전은 다음의 명령어로 확인하자. 커널이 노드 부팅에 매우 중요하기 때문에</span></p><p><span style="font-family: Dotum; font-size: 10pt;"><br></span></p><p><span style="font-family: Dotum; font-size: 10pt;">커널 버전을 확실히 구분하여 관리하는 것이 서버 관리의 핵심 노하우이다.</span></p><p><span style="font-family: Dotum; font-size: 10pt;"><br></span></p><p><span style="font-family: Dotum; font-size: 10pt;"># uname -r</span></p><p><span style="font-family: Dotum; font-size: 10pt;"><br></span></p><p><span style="font-family: Dotum; font-size: 10pt;">나중에 루트파일시스템을 다시 다운 받을 필요 없이</span></p><p><span style="font-family: Dotum; font-size: 10pt;"><br></span></p><p><span style="font-family: Dotum; font-size: 10pt;">이&nbsp;원형 폴더에 있는 루트파일시스템을 이용하면 된다.</span></p><p><span style="font-family: Dotum; font-size: 10pt;"><br></span></p><span style="font-family: Dotum; font-size: 10pt;"><p><span style="font-family: Dotum; font-size: 10pt;">그리고 기본 작업을 해줄 default 폴더에 복사해주자.&nbsp;</span></p><p><br></p></span><p style="margin-left: 2em;"><span style="font-family: Dotum; font-size: 10pt;"># rsync -aHv --delete /nfsroot/xenial-&lt;kernel version&gt;/ /nfsroot/default</span></p><p style="margin-left: 2em;"><span style="font-family: Dotum; font-size: 10pt;"><br></span></p><p><span style="font-family: Dotum; font-size: 10pt;">이 명령어는 단방향 동기화 명령어이다. xenial-&lt;kernel version&gt; </span></p><p><span style="font-family: Dotum; font-size: 10pt;"><br></span></p><p><span style="font-family: Dotum; font-size: 10pt;">이 default 폴더에는 노드의 루트파일시스템에 필요한 최소한의 앱들과 설정들을 적용할 것이다.</span></p><p><span style="font-family: Dotum; font-size: 10pt;"></span></p><p><span style="font-family: Dotum; font-size: 10pt;"><span style="font-family: Dotum; font-size: 10pt;">/etc/apt/sources.list 수정</span></span></p><p><span style="font-family: Dotum; font-size: 10pt;">locales, nfs-common,&nbsp;vim, htop, aptitude&nbsp;앱 설치</span></p><p><span style="font-family: Dotum; font-size: 10pt;">/etc/fstab 수정</span></p><p><span style="font-family: Dotum; font-size: 10pt;">/etc/hostname 수정</span></p><p><span style="font-family: Dotum; font-size: 10pt;">/etc/hosts 수정</span></p><p><span style="font-family: Dotum; font-size: 10pt;"><br></span></p><p><span style="font-family: Dotum; font-size: 10pt;">그리고 계산 노드로 쓰기위한 python 이나 nvidia 모듈들을 설치한 nfsroot 파일들은</span></p><p><span style="font-family: Dotum; font-size: 10pt;"><br></span></p><p><span style="font-family: Dotum; font-size: 10pt;">따로 만들 것이다. 그래야지만 번거로운 과정을 반복하지 않을 수 있다. 이것이 '노하우'!</span></p><p><span style="font-family: Dotum; font-size: 10pt;"><br></span></p><p><span style="font-family: Dotum; font-size: 10pt;">그리고 뒤에 / 의 유무를 반드시 확인하자. source 에는 있어야하고 destination 에는 없어야 한다.</span></p><p><span style="font-family: Dotum; font-size: 10pt;"><br></span></p><p><span style="font-family: Dotum; font-size: 10pt;">- v 옵션은 업데이트 과정을 보여달라는 옵션이다.</span></p><p><span style="font-family: Dotum; font-size: 10pt;"><br></span></p><p><span style="font-family: Dotum; font-size: 10pt;">이는 빼도 괜찮다. 하지만 나는 보고 싶으니 빼지 않겠다.</span></p><p><br></p><hr style="border-width: 1px 0px 0px; border-style: solid none none; border-color: black; border-image: none; height: 1px; display: block;"><p><span style="color: rgb(255, 187, 0); font-family: Dotum; font-size: 10pt;">주의사항</span></p><p><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;">만약</span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;"> /nfsroot/default </span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;">디렉토리</span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;"> </span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;">및</span><span style='line-height: 107%; font-family: "Times New Roman",serif; font-size: 10pt; mso-fareast-font-family: 바탕; mso-ansi-language: EN-US; mso-fareast-language: KO; mso-bidi-language: AR-SA;'><span style="font-family: Dotum; font-size: 10pt;"> </span><span style="font-family: Dotum; font-size: 10pt;">/nfsroot/y101
</span></span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;">디렉토리에</span><span style='line-height: 107%; font-family: "Times New Roman",serif; font-size: 10pt; mso-fareast-font-family: 바탕; mso-ansi-language: EN-US; mso-fareast-language: KO; mso-bidi-language: AR-SA;'><span style="font-family: Dotum; font-size: 10pt;"> </span><span style="font-family: Dotum; font-size: 10pt;">chroot </span></span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;">환경을</span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;"> </span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;">사용하기</span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;"> </span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;">위해</span><span style='line-height: 107%; font-family: "Times New Roman",serif; font-size: 10pt; mso-fareast-font-family: 바탕; mso-ansi-language: EN-US; mso-fareast-language: KO; mso-bidi-language: AR-SA;'><span style="font-family: Dotum; font-size: 10pt;"> </span><span style="font-family: Dotum; font-size: 10pt;">&lt;nfsroot&gt;/proc
</span></span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;">및</span><span style='line-height: 107%; font-family: "Times New Roman",serif; font-size: 10pt; mso-fareast-font-family: 바탕; mso-ansi-language: EN-US; mso-fareast-language: KO; mso-bidi-language: AR-SA;'><span style="font-family: Dotum; font-size: 10pt;"> </span><span style="font-family: Dotum; font-size: 10pt;">&lt;nfsroot&gt;/dev/pts/
</span></span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;">디렉토리를</span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;"> </span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;">특정</span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;"> </span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;">파일시스템으로</span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;"> </span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;">마운트하였다면</span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;"> </span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;">그를</span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;"> </span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;">해제해줘야</span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;"> </span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;">정상적으로</span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;"> </span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;">복사</span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;"> </span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;">과정이</span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;"> </span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;">끝날</span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;"> </span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;">것이다</span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;">. </span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;">따라서</span><span style='line-height: 107%; font-family: "Times New Roman",serif; font-size: 10pt; mso-fareast-font-family: 바탕; mso-ansi-language: EN-US; mso-fareast-language: KO; mso-bidi-language: AR-SA;'><span style="font-family: Dotum; font-size: 10pt;"> </span><span style="font-family: Dotum; font-size: 10pt;">rsync</span></span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;">를</span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;"> </span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;">통한</span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;"> </span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;">복사</span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;"> </span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;">및</span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;"> </span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;">동기화</span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;"> </span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;">직전에</span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;"> </span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;">두</span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;"> </span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;">디렉토리의</span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;"> </span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;">파일시스템</span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;"> </span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;">마운트를</span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;"> </span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;">꼭</span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;"> </span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;">해제하도록</span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;"> </span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;">하자</span><span style="line-height: 107%; font-family: Dotum; font-size: 10pt;">.&nbsp;</span><span style="font-size: 9pt;"><br></span></p><p><br></p><hr style="border-width: 1px 0px 0px; border-style: solid none none; border-color: black; border-image: none; height: 1px; display: block;"><p><span style='line-height: 107%; font-family: "Times New Roman",serif; font-size: 10pt; mso-fareast-font-family: 바탕; mso-ansi-language: EN-US; mso-fareast-language: KO; mso-bidi-language: AR-SA;'><br></span></p>
                        </div>
                        <br/>
                        <div class="tags">
                            
                        </div>
                    </div>
                    
                </div>
            </div>
        </main>
    </div>
</div>
</body>
</html>
