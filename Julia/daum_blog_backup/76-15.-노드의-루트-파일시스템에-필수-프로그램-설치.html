
<meta charset="utf-8">
<html lang="ko">
<head>
    <link rel="stylesheet" type="text/css" href="./../style.css" />
    <title>15. 노드의 루트 파일시스템에 필수 프로그램 설치</title>
</head>
<body id="tt-body-page" class="">
<div id="wrap" class="wrap-right">
    <div id="container">
        <main class="main ">
            <div class="area-main">
                <div class="area-view">
                    <div class="article-header">
                        <div class="inner-article-header">
                            <div class="box-meta">
                                <h2 class="title-article">15. 노드의 루트 파일시스템에 필수 프로그램 설치</h2>
                                <div class="box-info">
                                    <p class="category">리눅스/데비안 서버 구축</p>
                                    <p class="date">2016-10-06 11:29:14</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="article-view">
                        <div class="contents_style">
                            <p><span style="color: rgb(70, 70, 70);">vim 에디터는 맨처음 리눅스 설치하자마자 설치하였으므로 넘기겠다.</span></p><p><span style="color: rgb(255, 187, 0); font-size: 14pt;"><br></span></p><p><span style="color: rgb(70, 70, 70); font-size: 14pt;"><b>SSH 설치</b></span></p><p><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">노드에서 서버로 ssh 접속을 하려면 openssh-client 패키지가 필요하고, 반면 다른 노드에서</span></p><p><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">현재 노드로 올 때는 현재 노드에 openssh-server 패키지가 필요하다. 즉 모든 서버 및 노드에는</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">openssh-client 와 openssh-server 패키지가 다 설치되어 있어야 한다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);"># aptitude install -y openssh-client openssh-server sshpass</span><br></p><p><br><br><span style="color: rgb(70, 70, 70); font-size: 14pt;"><b>Intel C, C++ compiler 설치</b></span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">yboot 의 /root 에 설치할 것이다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">모든 노드와 yhome 은 yboot /root 를 자신의 /root 로 mount 하기 때문에,</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">aptitude 를 이용하여 설치하는 것이 아닌 모든 앱은 yboot 의 /root 에 설치하면 된다.</span></p><p><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">먼저 구글에 intel c compiler noncommercial 이라고 쳐서 여차저차해서 다운 받는다.</span></p><p><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">icc는 라이센스가 있어야지만 다운 받을 수 있다. 물론 무료이기는 하다.</span></p><p><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">(그래서 간접 실행 할 때 라이센스문제가 발생하는 경우가 있다)</span></p><p><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">usb로 압축 파일을 옮긴 뒤 부팅 서버에 꽂는다. 그 다음 인식이 됐는지 확인한다.</span></p><p><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);"># cd /dev</span></p><p><span class="Apple-tab-span" style="white-space: pre; color: rgb(70, 70, 70);">	</span></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);"># ls sd*</span></p><p><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">새로 생긴 파티션이 보일 것이다. 예를 들어</span></p><p><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">sdb sdb1</span></p><p><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">이 새로 생겼다고 하자. sdb1 을 mount 해야한다. 그게 파티션이니까.</span></p><p><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">그 다음으로는 usb를 mount 해야한다.</span></p><p><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);"># cd /mnt</span></p><p><span class="Apple-tab-span" style="white-space: pre; color: rgb(70, 70, 70);">	</span></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);"># mkdir usb</span></p><p><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);"># mount /dev/sdb1 /mnt/usb</span></p><p><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">이제 usb 폴더 안으로 들어가서 압축파일을 꺼내 온다.</span></p><p><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);"># cp /mnt/usb/parallel_studio_xe_2016_update1.tgz /root</span></p><p><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">(여기서 /root는 root 관리자의 home 디렉토리이다)</span></p><p><br></p><p><span class="Apple-tab-span" style="white-space: pre; color: rgb(70, 70, 70);">	</span><span style="color: rgb(70, 70, 70);">cd /root</span></p><p><br></p><p><span class="Apple-tab-span" style="white-space: pre; color: rgb(70, 70, 70);">	</span><span style="color: rgb(70, 70, 70);">이제 압축파일이 보일 것이다. 압축을 푸는 방법은 다음과 같다.</span></p><p><br></p><p><span class="Apple-tab-span" style="white-space: pre; color: rgb(70, 70, 70);">	</span><span style="color: rgb(70, 70, 70);">tar -zxvf parallel-studio_xe_2016_update1.tgz</span></p><p><br></p><p><span class="Apple-tab-span" style="white-space: pre; color: rgb(70, 70, 70);">	</span><span style="color: rgb(70, 70, 70);">이제 같은 이름의 폴더가 만들어졌을 것이다.</span></p><p><br></p><p><span class="Apple-tab-span" style="white-space: pre; color: rgb(70, 70, 70);">	</span><span style="color: rgb(70, 70, 70);">cd parallel-studio_xe_2016_update1</span></p><p><br></p><p><span class="Apple-tab-span" style="white-space: pre; color: rgb(70, 70, 70);">	</span><span style="color: rgb(70, 70, 70);">여기서 설치 파일을 실행하자.</span></p><p><br></p><p><span class="Apple-tab-span" style="white-space: pre; color: rgb(70, 70, 70);">	</span><span style="color: rgb(70, 70, 70);">./install.sh</span></p><p><br></p><p><span class="Apple-tab-span" style="white-space: pre; color: rgb(70, 70, 70);">	</span><span style="color: rgb(70, 70, 70);">설치 과정 중에 시리얼 넘버를 입력해서 인증을 받도록하자. 학교 메일로 시리얼 넘버가 와 있다.</span></p><p><br></p><p><span class="Apple-tab-span" style="white-space: pre; color: rgb(70, 70, 70);">	</span><span style="color: rgb(70, 70, 70);">전부 default 값으로 설치를 하면 /opt/intel 이라는 폴더가 만들어진다. 여기로 가자.</span></p><p><br></p><p><span class="Apple-tab-span" style="white-space: pre; color: rgb(70, 70, 70);">	</span><span style="color: rgb(70, 70, 70);">cd /opt/intel/bin</span></p><p><br></p><p><span class="Apple-tab-span" style="white-space: pre; color: rgb(70, 70, 70);">	</span><span style="color: rgb(70, 70, 70);">ls</span></p><p><br></p><p><span class="Apple-tab-span" style="white-space: pre; color: rgb(70, 70, 70);">	</span><span style="color: rgb(70, 70, 70);">여기 보면 compilervars.sh 라는 파일이 있다. 이놈의 위치를 잘 기억해두자.</span></p><p><br></p><p><span class="Apple-tab-span" style="white-space: pre; color: rgb(70, 70, 70);">	</span><span style="color: rgb(70, 70, 70);">부팅 서버에 root 권한으로 접속한 뒤 vi /etc/bash.bashrc 해서 들어간 다음 마지막 줄에</span></p><p><br></p><p><span class="Apple-tab-span" style="white-space: pre; color: rgb(70, 70, 70);">	</span><span style="color: rgb(70, 70, 70);">source /opt/intel/bin/compilervars.sh intel64</span></p><p><br></p><p><span class="Apple-tab-span" style="white-space: pre; color: rgb(70, 70, 70);">	</span><span style="color: rgb(70, 70, 70);">를 입력해준다.</span></p><p><br></p><p><span class="Apple-tab-span" style="white-space: pre; color: rgb(70, 70, 70);">	</span><span style="color: rgb(70, 70, 70);">커맨드 라인에 icc 나 icpc를 쳐서 명령어가 인식이 되는지 다시 확인한다.</span></p><p><br></p><p><span class="Apple-tab-span" style="white-space: pre; color: rgb(70, 70, 70);">	</span><span style="color: rgb(70, 70, 70);">서버에 설치해줬으니 노드에도 설치해줘야한다. (사실 노드에만 설치하면 된다)</span></p><p><br></p><p><span class="Apple-tab-span" style="white-space: pre; color: rgb(70, 70, 70);">	</span><span style="color: rgb(70, 70, 70);">압축 파일이나 압축을 푼 폴더를 노드의 루트 파일 시스템으로 옮긴다.</span></p><p><span class="Apple-tab-span" style="white-space: pre; color: rgb(70, 70, 70);">	</span></p><p><span class="Apple-tab-span" style="white-space: pre; color: rgb(70, 70, 70);">	</span><span style="color: rgb(70, 70, 70);">cp /root/parallel-studio_xe_2016_update1 /nfsroot/default/root</span></p><p><br></p><p><span class="Apple-tab-span" style="white-space: pre; color: rgb(70, 70, 70);">	</span><span style="color: rgb(70, 70, 70);">이제 proc과 pts를 마운트 한다. (chroot 환경으로 들어가기 위해)</span></p><p><br></p><p><span class="Apple-tab-span" style="white-space: pre; color: rgb(70, 70, 70);">	</span><span style="color: rgb(70, 70, 70);">mount none</span></p><p><span class="Apple-tab-span" style="white-space: pre; color: rgb(70, 70, 70);">	</span><span style="color: rgb(70, 70, 70);">mount devpts</span></p><p><br></p><p><span class="Apple-tab-span" style="white-space: pre; color: rgb(70, 70, 70);">	</span><span style="color: rgb(70, 70, 70);">chroot /nfsroot/default</span></p><p><br></p><p><span class="Apple-tab-span" style="white-space: pre; color: rgb(70, 70, 70);">	</span><span style="color: rgb(70, 70, 70);">같은 방식으로 설치하면 된다. 만약 노드에 설치할 때 gcc 어쩌구 에러가 나면</span></p><p><br></p><p><span class="Apple-tab-span" style="white-space: pre; color: rgb(70, 70, 70);">	</span><span style="color: rgb(70, 70, 70);"># aptitude install -y gcc</span></p><p><br></p><p><span class="Apple-tab-span" style="white-space: pre; color: rgb(70, 70, 70);">	</span><span style="color: rgb(70, 70, 70);">해주면 된다. gcc 는 GNU C compiler 의 약자이다. 즉 무료버젼 C 컴파일러이다.</span></p><p><br><span style="color: rgb(70, 70, 70); font-size: 14pt;"><b>cpunode 용 python 설치</b></span><br></p><p><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">171128 굉장히 중요한 사실 발견!</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">anaconda python 은 /anaconda3 이렇게 하면 nfsroot로 했을때</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">네트워크 마운트가 되지 않는다! /etc/anaconda3 혹은 /usr/anaconda3 이렇게 해야하는데</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">아나콘다 자체가 용량이 커서 그렇게 하려면 랜선을 전부 CAT.7 STP 로 교체하고</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">랜카드도 10 Gb/s 인지도 다들 확인해야한다. 노드의 루트파일 시스템은 가벼울 수록 좋기 때문에</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">그냥 aptitude 로 설치해서 쓰는게 제일 속편하고 정신 건강에 좋다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">리눅스는 커널에서 python 을 지원하기 때문에 환경변수가 정해져 있어서,</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">아나콘다를 사용할 경우 환경변수를 바꿔줘야하는 불편함도 있다. </span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">그니까 웬만하면 aptitude 로만 모든 앱을 설치하고 사용하자... 최신 gpu 와 앱들을 쓸 수 없음은</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">감안하자. 골치 아픈 것보다는 훨씬 낫다.</span></p><p style="margin-left: 2em;"><br></p><div style="background: url(&quot;//i1.daumcdn.net/deco/contents/horizontalrule/line06.gif?v=2&quot;) repeat-x left; width: 99%; height: 15px;"><hr style="border: 0px black; border-image: none; left: -9999px; top: -9999px; position: relative;"></div><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">Linux 에 Anaconda Python 을 설치하는 방법</span><br></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">yboot 에는 설치하지 않는다는 점을 명심.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">anaconda python3 를 인터넷에서 다운 받아서 xftp 를 이용해 yboot:/root 에 저장한다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">그리고 다음 폴더를 만들어 주자.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);"># mkdir this.is.yboot.root</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">이는 노드의 /root 와 yboot 의 /root 를 구별하기 위한 것이다. 그리고 노드의 /root 로 복사하자.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);"># cp Anaconda어쩌구 /nfsroot/cpunode/root</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">그리고 설치하자. 모든 것은 root 계정으로 진행한다!</span></p><p><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);"># bash Anaconda 어쩌구 .sh</span></p><p><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">쭉 설치과정에서 yes 혹은 엔터를 누르다보면 설치 경로를 지정해야 한다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">default 값으로 현재 사용자의 홈폴더가 지정되는데, (~/anaconda3)</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">우린 모든 사용자가 anaconda3 를 사용하게 할 것이므로 다음으로 설정하자.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">/usr/anaconda3</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">설치를 마치면 환경변수를 설정해주는 창이 뜬다. 환경변수를 등록해주는 이유는, python 명령을</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">넣을 때 리눅스 기본 파이썬이 실행되지 말고 아나콘다 파이썬이 실행되도록 하기 위한 것이다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">각 사용자만의 환경변수를 변화시키려면 ~/.bashrc 의 내용을 수정해주면 되지만, 우린 모든 사용자의</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">환경변수를 바꿀 것이므로 /etc/bash.bashrc 에 다음 내용을 추가한다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">export PATH="/usr/anaconda3/bin:$PATH"</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">아나콘다2 라면 알아서 센스있게 폴더명 바꿔주자. 그리고 바뀐 bashrc 내용을 적용해주자.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);"># source /etc/bash.bashrc</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">이는 해당 사용자의 환경변수에 yboot의 /root/anaconda3/bin 을 등록해주는 과정이다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">이제 python 혹은 python3 명령어를 입력하면 자동으로 anaconda 3 가 실행될 것이다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">반면 python2 라고 하면 리눅스 기본 python2 가 열린다. 물론 최근 리눅스는 기본으로 python3 가</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">설치되므로, python2 를 이용해야할 일이 있을땐 aptitude install python 해줘서 설치해놓으면 됨.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">그리고 conda 가 되는지 확인해본다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);"># conda --v</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">그리고 필요한 패키지를 설치하자.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);"># conda install pip scipy</span><br></p><div style="background: url(&quot;//i1.daumcdn.net/deco/contents/horizontalrule/line06.gif?v=2&quot;) repeat-x left; width: 99%; height: 15px;"><hr style="border: 0px black; border-image: none; left: -9999px; top: -9999px; position: relative;"></div><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">aptitude 를 이용해 python package 설치하기</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">아나콘다를 이용하지 않을 경우 다음의 과정을 따른다.</span><br></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">노드의 루트파일 시스템으로 들어가서 aptitude 로 다음 패키지명과 '정확히' 같은 것을 찾아</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">설치하면 된다.</span><br></p><p><br></p><p><span class="Apple-tab-span" style="white-space: pre; color: rgb(70, 70, 70);">	</span><span style="color: rgb(70, 70, 70);">#chroot /nfsroot/default</span></p><p><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">python3-numpy</span></p><p style="margin-left: 2em;"><span style="font-size: 9pt; color: rgb(70, 70, 70);">python3-scipy</span></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">python3-matplotlib</span></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">python3-h5py</span></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">python3-psutil</span></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">python3-pip</span></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">python3-mpi4py</span></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">ipython3</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">python-numpy</span></p><p style="margin-left: 2em;"><span style="font-size: 9pt; color: rgb(70, 70, 70);">python-scipy</span></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">python-matplotlib</span></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">python-h5py</span></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">python-psutil</span></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">python-pip</span></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">python-mpi4py</span></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">ipython</span></p><p style="margin-left: 2em;"><b><br></b></p><p><span style="color: rgb(70, 70, 70); font-size: 14pt;"><b>gpunode 용 python 설치</b></span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">gpunode 는 cpunode 의 nfsroot 에 패키지를 더 추가함으로써 만들 수 있다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">즉 cpunode 부터 만들고 이 다음 과정을 따라하길 바란다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(255, 187, 0);"><strong><span style="color: rgb(70, 70, 70);">먼저 서버에도 gpu 를 하나 장착한다. </span></strong></span><span style="color: rgb(70, 70, 70);">그래야 chroot 환경에서 cuda 를 설치할 수 있다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">서버의 커널과 커널 모듈이 gpu 를 인식할 수 없다면 설치가 중간에서 중단된다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">또한 엔비디아의 cuda 를 설치하면 gui 도 같이 설치된다. 그래서 gpunode 의 nfsroot 파일은 무겁다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">따라서 gpunode 의 nfsroot 파일은 cpunode 의 nfsroot 파일과 반드시 구별하여 관리하자.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(255, 187, 0);"><strong><span style="color: rgb(70, 70, 70);">또한 cuda toolkit 을 설치하고 나면 커널과 커널 모듈이 업데이트 된다.</span></strong></span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">따라서 먼저 현재 서버의 kernel 과 kernel module 의 버전을 확인해보자.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);"># ls -alph /boot</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);"># ls -alph /etc/</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">가장 최근의 업데이트 날짜를 확인하고 백업해놓자.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);"># cp -a /boot/vmlinuz-&lt;version&gt; /tftpboot/vmlinuz-&lt;kernel version&gt;.cpunode.&lt;date&gt;</span></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);"># cp -a /etc/initramfs-tools /etc/initramfs-tools-&lt;kernel version&gt;.cpunode.&lt;date&gt;</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">커널과 커널 모듈의 백업을 마쳤다면 이제 aptitude 를 이용해서 nvidia driver 와 python 모듈을</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">설치하도록 한다. 이 과정 후 커널과 커널 모듈이 업데이트 될 것이다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">chroot 로 gpunode의 nfsroot 로 들어가 다음의 이름을 aptitude 에서 검색하여 설치하자.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 4em;"><span style="color: rgb(70, 70, 70);"># chroot /nfsroot/gpunode</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 4em;"><span style="color: rgb(70, 70, 70);">python3-pyopencl</span></p><p style="margin-left: 4em;"><span style="color: rgb(70, 70, 70);">python3-pycuda</span></p><p style="margin-left: 4em;"></p><p style="margin-left: 4em;"><span style="color: rgb(70, 70, 70);">python-pyopencl</span></p><p style="margin-left: 4em;"><span style="color: rgb(70, 70, 70);">python-pycuda</span></p><p style="margin-left: 4em;"><br></p><p style="margin-left: 4em;"><span style="color: rgb(70, 70, 70);"># pip install reikna scikit-cuda</span></p><p style="margin-left: 4em;"><span style="color: rgb(70, 70, 70);"># pip3 install reikna scikit-cuda</span><br></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">설치되정이 끝났으면 커널와 커널 모듈이 업데이트 되었는지 확인하자.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 4em;"><span style="color: rgb(70, 70, 70);"># exit</span></p><p style="margin-left: 4em;"><span style="color: rgb(70, 70, 70);"># ls -alph /boot/</span></p><p style="margin-left: 4em;"><span style="color: rgb(70, 70, 70);"># ls -alph /etc/inintramfs*</span></p><p style="margin-left: 4em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">파일의 생성 날짜가 방금 전인지 확인하고, 다시 백업하자.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);"># cp -a /boot/vmlinuz-&lt;version&gt; /tftpboot/vmlinuz-&lt;kernel version&gt;.gpunode.&lt;date&gt;</span></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);"># cp -a /etc/initramfs-tools /etc/initramfs-tools-&lt;kernel version&gt;.gpunode.&lt;date&gt;</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">업뎃된 kernel 과 kernel module 을 이용해 노드의 kernel, kernel module 을 다시 만들어줘야함!</span></p><p style="margin-left: 2em;"><br></p><div style="background: url(&quot;//i1.daumcdn.net/deco/contents/horizontalrule/line06.gif?v=2&quot;) repeat-x left; width: 99%; height: 15px;"><hr style="border: 0px black; border-image: none; left: -9999px; top: -9999px; position: relative;"></div><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">171129 에 gpunode nfsroot 를 설치하는 과정에서 다음을 발견.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">chroot 로 nvidia-cuda-toolkit 을 설치하면 서버의 커널과 커널 모듈이 업데이트 되는데,</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">/boot/vmlinuz-4.4.0-87-generic.efi.signed</span></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">/etc/initramfs-tools.4.4.0-87-generic.efi.signed</span><strike></strike></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">라고 새로운 커널과 커널 모듈이 생성되어 있는 것을 보았다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">이 것을 gpunode 용 커널/커널 모듈로 사용하면 된다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">gpunode 용 커널과 커널 모듈을 반드시 따로 관리하자.</span></p><div style="background: url(&quot;//i1.daumcdn.net/deco/contents/horizontalrule/line06.gif?v=2&quot;) repeat-x left; width: 99%; height: 15px;"><hr style="border: 0px black; border-image: none; left: -9999px; top: -9999px; position: relative;"></div><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(255, 187, 0);"><strong><span style="font-size: 12pt; color: rgb(70, 70, 70);">Debian:</span></strong></span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">GPU 노드용 nfsroot 인 경우 다음의 과정을 진행하자.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);"># aptitude install -y nvidia-detect</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">이 앱은 현재 장착된 NVIDIA GPU 를 사용하려면 어떤 드라이버를 설치해야하는지 알려주는 앱이다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);"># nvidia-detect</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">이러면 이제 결과가 몇줄 쫙 나온다. 사용가능하다면 그대로 다음 과정으로 넘어가자.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">만약 신 버전이 필요하다면 aptitude 로 설치해서 다시 nvidia-detect 해보면 된다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">문제는 다음과 같은 의미의 에러가 발생했을 때이다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">"backports 를 이용하라!"</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">데비안 stable 은 안정적이라는 아주 좋은 장점이 있지만 이로 인해 매우 치명적인 단점이 </span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">하나 존재하는데, 구동하는 앱들이 상대적으로 구버전이라는 것이다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">이럴 경우를 대비해 데비안 stable 에서는 testing 에서 적용되고 있는 최신 앱들을 stable 로</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">컴파일한 패키지 소스를 제공하고 있다. 그것이 Debian-backports 라는 FTP 사이트이다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><strong><span style="color: rgb(70, 70, 70); font-size: 9pt;">주의: backports 를 이용하기 전에 반드시 노드가 정상적으로 원격부팅이 되는지 ssh 가 되는지 mpi 가 되는지 모두 확인한 다음에 패키지를 설치하자! backports 를 이용해 패키지를 업뎃하면 서버 </span><span style="color: rgb(70, 70, 70); font-size: 9pt;">커널의 버전이 업그레이드 되는 수가 있다. 노드의 커널은 버전 업이 안되므로, 심각한 오류 발생할 가능성 있다. 정상적으로 될 수도 있고... 한번 건너면 다신 못 돌아오니까 신중! 또 신중!</span></strong></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">sources.list 에 다음의 내용을 추가하자.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);"># chroot /nfsroot/gpunode</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);"># vi /etc/apt/sources.list</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">deb </span><a href="http://ftp.debian.org/debian" target="_blank"><span style="color: rgb(70, 70, 70);">http://ftp.debian.org/debian</span></a><span style="color: rgb(70, 70, 70);"> jessie-backports main non-free contrib</span><br><span style="color: rgb(70, 70, 70);">deb </span><a href="http://ftp.debian.org/debian" target="_blank"><span style="color: rgb(70, 70, 70);">http://ftp.debian.org/debian</span></a><span style="color: rgb(70, 70, 70);"> jessie-backports-sloppy main non-free contrib</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">이 때 jessie 말고 해당되는 stable 버전의 코드명을 넣어주면 된다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);"># aptitude update</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">backports 는 default 값이 off 이기 때문에 명령어로 항상 켜주어야 한다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);"># aptitude -t jessie-backports&nbsp;install -y nvidia-cuda-toolkit nvidia-driver nvidia-detect</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);"># pip install reikna scikit-cuda pycuda pyopencl</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">reikna 는 pycuda 나 pyopencl 에서 사용할 수 있는 라이브러리 집합체인 패키지이다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">FFT 를 GPU 로 하려면 반드시 필요.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="font-size: 11pt;"><strong><span style="color: rgb(70, 70, 70); font-size: 9pt;">주의 : jessie-backports 를 설치하기 위해서는 반드시 모든 노드가 정상적으로 원격부팅이 되는 것이 확인되고 난 후에 진행해야 한다. 그리고 나서는 절대로 노드의 커널/커널 모듈을 건드리면 안된다!</span></strong></span></p><p style="margin-left: 2em;"><span style="font-size: 11pt;"><strong><span style="color: rgb(255, 187, 0);"><br></span></strong></span></p><p style="margin-left: 2em;"><span style="font-size: 11pt;"><strong><span style="color: rgb(70, 70, 70);">UBUNTU:</span></strong></span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">우분투에는 nvidia-detector 라는 앱이 있다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);"># nvidia-detector</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">이러면 현재 가동 중인 nvidia driver 를 확인할 수 있다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">aptitude 를 이용해 nvidia-cuda-toolkit 을 설치하면 매우 옛날버전이 설치된다. </span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);"># aptitude install -y python3-pycuda python3-pyopencl</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">이 때 절대로 nvidia-cuda-toolkit 을 직접적으로 설치하지 않는다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">python3-pycuda 를 설치하면 nvidia-cuda-toolkit 과 함께 앱 구동에 필요한 최소한의</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">dependency 로 앱들이 설치되지만, 직접적으로 nvidia-cuda-toolkit 을 설치하는 순간</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">600개 이상의 다른 앱이 함께 설치되므로 절대로 하지 않는다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">옛날버전을 설치하던가, 아니면 수동으로 설치한다.</span></p><p style="margin-left: 2em;"><br></p><div style="background: url(&quot;//i1.daumcdn.net/deco/contents/horizontalrule/line06.gif?v=2&quot;) repeat-x left; width: 99%; height: 15px;"><hr style="border: 0px black; border-image: none; left: -9999px; top: -9999px; position: relative;"></div><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">NVIDIA 홈페이지에서 직접 드라이버를 다운 받아 수동 설치하는 방법을 알아보자.</span><br></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">매뉴얼 설치법은 엔비디아의 cuda toolkit documentation 에 잘 나와 있으니 그걸 참고하자.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">수동 설치이므로 엔비디아 홈페이지에서 직접 cuda toolkit 을 다운 받아서, aptitude 리스트에</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">source 로 지정하고, cuda 를 설치하는 과정이 설명돼 있다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">재밌는건 'cuda' 라는 이름의 패키지만 설치하면 nvida-cuda-toolkit, nvidia-smi, nvidia-driver 등이</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">모두 설치되니깐 고민 싹 사라진다. aptitude 의 repository 는 업뎃이 매우 늦다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">aptitude 의&nbsp;cuda driver 버전으로는 3,4년전 gpu 까지 밖에 못 돌림.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><a href="http://christopher5106.github.io/nvidia/2016/12/30/commands-nvidia-install-ubuntu-16-04.html" target="_blank"><span style="color: rgb(70, 70, 70);">http://christopher5106.github.io/nvidia/2016/12/30/commands-nvidia-install-ubuntu-16-04.html</span></a></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">이 사이트도 참조해보자.</span></p><p style="margin-left: 2em;"><br></p><p><span style="color: rgb(70, 70, 70); font-size: 14pt;"><b>openmpi 설치</b></span></p><p><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">mpi 라이브러리에는 mpich, openmpi, intel mpi library 등이 있다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">이 셋 중 하나를 설치하면 mpicc 가 설치된다. 이는 mpi c compiler 의 줄임말이다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">그리고 저 세 개는 mpicc compiler wrapper 라고 부른다. 여러개의 wrapper 가 설치되어 있으면</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">그 중에 선택해서 컴파일을하고 실행할 수 있다. 우리는 굳이 여러 개 필요 없다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">반면&nbsp;mpicc&nbsp;는 두 개 이상 설치되어 있으면 충돌 에러가 나므로, 하나만 설치해야 한다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">intel c compiler 를&nbsp; 설치하면 인텔사의 mpicc 가 같이 설치 된다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">만약 intel c compiler 를 설치하지 않았다면, openmpi 를 설치하도록 하자.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">모든 패키지는 수동으로 설치하는 것을 권장한다.&nbsp;aptitude의&nbsp;패키지 관리는 정말 발암이기 때문.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">아나콘다를 사용한다면 /etc/bash.bashrc 에 아나콘다 파이썬으로 환경변수를 설정해놓고</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">다음 과정을 진행하길 바란다. 수동으로 설치할 때 파이썬을 이용할 것이기 때문이다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">설치하는 방법은 여러가지가 있다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">1. aptitude 를 이용해 설치</span></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">2. python documentation 을 따라 소스 파일로부터 설치</span></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">3. conda 의 openmpi 패키지 설치</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">이중 가장 잘되는 것, 확실히 되는 것은 1 번 설치방법이었다. 3번은 아무리 해봐도 안되더라.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">공식 파이썬 documentation 의 설치 방법은 다음과 같다.</span></p><div style="background: url(&quot;//i1.daumcdn.net/deco/contents/horizontalrule/line06.gif?v=2&quot;) repeat-x left; width: 99%; height: 15px;"><hr style="border: 0px black; border-image: none; left: -9999px; top: -9999px; position: relative;"></div><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><a href="https://mpi4py.scipy.org/docs/usrman/install.html"><span style="color: rgb(70, 70, 70);">https://mpi4py.scipy.org/docs/usrman/install.html</span></a></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(255, 187, 0);"><strong><span style="color: rgb(70, 70, 70);"> 여기서&nbsp;pip 을 이용한 easy install 은 리눅스에 이미 mpi compiler 가 설치되어 있고,</span></strong></span></p><p style="margin-left: 2em;"><strong><br></strong></p><p style="margin-left: 2em;"><span style="color: rgb(255, 187, 0);"><strong><span style="color: rgb(70, 70, 70);">MPI가 제대로 작동하는 사람만 해야한다.</span></strong></span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">mpi4py 는 mpicc 와 파이썬을 서로 연결시켜주는 API 일 뿐인거다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">우린 아직 어떠한 mpi compiler 도 설치하지 않았으므로</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">컴파일러부터 설치해야한다. 컴파일러를 설치하는 doc 은 다음 주소에 있다. openmpi 를 설치하자.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><a href="https://mpi4py.scipy.org/docs/usrman/appendix.html#python-mpi"><span style="color: rgb(70, 70, 70);">https://mpi4py.scipy.org/docs/usrman/appendix.html#python-mpi</span></a></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">공식 doc 에서도 distutils 를 통한 수동 설치를 권장하고 있다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">여기에서 distutils 를 이용한 설치방법을 따라하자. 다음 내용은 17.11.27 에 시도한 내용이다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">root 권한으로 chroot 를 통해&nbsp;노드의 루트파일로 바꾼 뒤&nbsp;/root 폴더에서 다음 명령을 실행하자.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);"># chroot /nfsroot/gpunode</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);"># ch /root/</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">#&nbsp;wget </span><a href="https://bitbucket.org/mpi4py/mpi4py/downloads/mpi4py-3.0.0.tar.gz"><span style="color: rgb(70, 70, 70);">https://bitbucket.org/mpi4py/mpi4py/downloads/mpi4py-3.0.0.tar.gz</span></a><br></p><p><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);"># tar -zxf mpi4py-3.0.0.tar.gz</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);"># cd mpi4py-3.0.0</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">아나콘다를 사용한다면 반드시 python 환경변수를 /etc/bash.bashrc 에 등록하고 다음 과정을 진행해야한다 아니면 아나콘다 파이썬에서 mpi4py 를 할 수 없다!</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);"># python setup.py build</span></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);"># python setup.py install</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">설치가 완료 되었으므로 test 를 해보자.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);"># mpiexec -n 5 python -m mpi4py.bench helloworld</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">이 때 /etc/hosts 와 /etc/hostsname 의 내용이 서로 잘 맞아야 오류가 안난다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">가령 서버의 /etc/hosts 에는 192.168.100.1 이 yboot 로 돼있는데 /etc/hostname 에는 gpucluster 로</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">되어 있다던지, 노드의 /etc/hosts 에 아무런 내용이 없다던지..</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);"># mpiexec -n 5 python demo/helloworld.py</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">다 잘된다면 마지막으로 ipython 에서 다음을 실행하자</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">from mpi4py import MPI</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">이 것마저 오류가 없으면 완성!</span><br></p><div style="background: url(&quot;//i1.daumcdn.net/deco/contents/horizontalrule/line06.gif?v=2&quot;) repeat-x left; width: 99%; height: 15px;"><hr style="border: 0px black; border-image: none; left: -9999px; top: -9999px; position: relative;"></div><p><br></p><p><span style="color: rgb(70, 70, 70);">다음은 aptitude 를 이용해서 설치하는 방법이다.</span><br></p><div style="background: url(&quot;//i1.daumcdn.net/deco/contents/horizontalrule/line06.gif?v=2&quot;) repeat-x left; width: 99%; height: 15px;"><hr style="border: 0px black; border-image: none; left: -9999px; top: -9999px; position: relative;"></div><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);"># aptitude install python3-mpi4py</span><br></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">python-mpi4py 혹은 python3-mpi4py 를 설치하면 openmpi-common 이 같이 설치가 될 것이다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="font-size: 9pt; color: rgb(70, 70, 70);">이는 곧 mpi4py 는 openmpi 를 기본적으로 이용한다는 뜻이다.</span></p><p style="margin-left: 2em;"><span style="font-size: 9pt;"><br></span></p><p style="margin-left: 2em;"><span style="font-size: 9pt; color: rgb(70, 70, 70);">그러나 openmpi-common 을 설치한다고 해서&nbsp;&nbsp;openmpi 의 mpicc( mpi c compiler) 가</span></p><p style="margin-left: 2em;"><span style="font-size: 9pt;"><br></span></p><p style="margin-left: 2em;"><span style="font-size: 9pt; color: rgb(70, 70, 70);">같이 설치되는 것은&nbsp;</span><span style="font-size: 9pt; color: rgb(70, 70, 70);">아니므로 </span><span style="font-size: 9pt; color: rgb(70, 70, 70);">따로 설치해주어야만 mpi 를 사용할 수 있다.</span></p><p style="margin-left: 2em;"><span style="font-size: 9pt;"><br></span></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">먼저 terminal 에서 mpicc 명령어가 존재하는지 살펴본다. 없으면 설치되지 않은 것이다.</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 4em;"><span style="color: rgb(70, 70, 70);"># python</span></p><p style="margin-left: 4em;"><br></p><p style="margin-left: 4em;"><span style="color: rgb(70, 70, 70);">&gt;&gt;&gt; import mpi4py</span></p><p style="margin-left: 4em;"><span style="color: rgb(70, 70, 70);">&gt;&gt;&gt; from mpi4py import MPI</span></p><p style="margin-left: 4em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">mpicc 가 없다면 mpi4py 는 import 가 되더라도 mpi4py.MPI 는 없을 것이다.</span></p><p style="margin-left: 4em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">그러면 이제 mpicc를 설치해보자.</span></p><p style="margin-left: 4em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);"># aptitude install openmpi-bin openmpi-common openssh-client openssh-server libopenmpi-dev</span></p><div style="background: url(&quot;//i1.daumcdn.net/deco/contents/horizontalrule/line06.gif?v=2&quot;) repeat-x left; width: 99%; height: 15px;"><hr style="border: 0px black; border-image: none; left: -9999px; top: -9999px; position: relative;"></div><p style="margin-left: 2em;"></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">설치하고 난 뒤 정상 작동하는지 테스트 해야한다. 이 때 반드시 /nfsroot/gpunode/etc/hostname 과</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">/nfsroot/gpunode/etc/hosts 가 제대로 되어 있는지 확인한다. 한마디로 노드의 hostname 이 hosts 에</span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">반드시 등록되어 있어야 한다는 뜻이다.</span></p><p style="margin-left: 2em;"><br></p><p><span style="color: rgb(255, 187, 0); font-size: 14pt;"><b><span style="color: rgb(70, 70, 70);">그 외 필수 유틸리티들</span></b></span></p><p style="margin-left: 2em;"><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">필수이지만 aptitude 를 이용해 간편히 설치 가능하므로 설치과정 적지 않겠다.</span></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">다음 이름의 app 을 aptitude 에서 검색하여 설치하자.</span></p><p><br></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">libfftw3-dev, libfftw3-doc - c 에서 fftw 를 사용할 수 있게 해줌.</span></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">hdfview - hdf 파일을 cmd 에서 볼 수 있게 해줌. </span></p><p style="margin-left: 8em;"><span style="color: rgb(70, 70, 70);">굉장히 무거우니 서버에만 설치하등가... 아예 하지 말등가.</span></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">imagemagick - 이미지 파일을 cmd 에서 볼 수 있게 해줌.</span></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">lshw - 하드웨어 스펙을 볼 수 있게 해줌.</span></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">htop - 프로세스 현황과 cpu, memory 점유율 등을 보여줌.</span></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">gdb&nbsp; - C 언어 컴파일 할 때 에러 내용을 확실히 알려줌. 매우 도움됨.</span></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">pycodestyle - python coding conventtion 을 체크해주는 프로그램. pip 으로 설치한다.</span></p><p style="margin-left: 2em;"><br></p><p><span style="color: rgb(255, 187, 0); font-size: 14pt;"><b><span style="color: rgb(70, 70, 70);">서버에만 필수 유틸리티</span></b></span></p><p style="margin-left: 2em;"><span style="color: rgb(70, 70, 70);">parted - 2TB 이상의 하드를 다룰 수 있음.</span></p>
                        </div>
                        <br/>
                        <div class="tags">
                            
                        </div>
                    </div>
                    
                </div>
            </div>
        </main>
    </div>
</div>
</body>
</html>
